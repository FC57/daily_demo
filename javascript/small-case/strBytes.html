<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Count Bytes</title>
  </head>
  <body>
    <h4>Count Bytes - å­—ç¬¦ä¸²æ‰€å å­—èŠ‚æ•°ï¼ˆUTF-8ï¼‰</h4>
    <hr />
    <p style="color: #00ff">ç›´æ¥é€šè¿‡å­—ç¬¦ä¸²lengthè¯»å–å­—ç¬¦é•¿åº¦ï¼Œæ˜¯ä¸å‡†ç¡®çš„</p>
    <p class="length">
      è¯»å–lengthï¼ŒğŸ… çš„é•¿åº¦ä¸º
      <span></span>
    </p>
    <p class="codePointAt_length">
      é€šè¿‡å­—ç¬¦ç ç‚¹åˆ¤æ–­ï¼ŒğŸ… çš„é•¿åº¦ä¸º
      <span></span>
    </p>
    <br />
    <p class="codePontByte">
      åˆ©ç”¨codePointAtçš„èŒƒå›´ç»Ÿè®¡ï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <p class="TextEncoder">
      åˆ©ç”¨TextEncoderå®ä¾‹æ–¹æ³•encodeè½¬æ¢ä¸ºUnit8Arrayå¹¶è¯»å–lengthï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <p class="blob">
      åˆ©ç”¨Blobçš„sizeå±æ€§ï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <script type="module">
      import { getLengthOfCodePoint, getUTF8ByteByCodePoint } from '/utils/string.js';

      /**
       * TextEncoderå®ä¾‹æ–¹æ³•encodeè·å–å­—ç¬¦ä¸²å­—èŠ‚æ•°
       * @param str{String}
       */
      function getStringByteByTextEncoder(str) {
        return new TextEncoder().encode(str).length;
      }

      /**
       * Blobç»Ÿè®¡å­—ç¬¦ä¸²æ‰€å å­—èŠ‚æ•°
       * @param str{String} å­—ç¬¦ä¸²
       */
      function getStringByteSize(str) {
        return new Blob([str]).size;
      }

      (() => {
        const $ = document.querySelector.bind(document);
        const str = 'ğŸ…';

        // è¯»å–lengthè·å–é•¿åº¦
        $('.length span').innerHTML = str.length;
        console.log(`å­—ç¬¦ä¸² ${str} è¯»å–lengthå±æ€§çš„é•¿åº¦ä¸º: ${str.length}`);

        // é€šè¿‡å­—ç¬¦ç ç‚¹åˆ¤æ–­é•¿åº¦
        const realLen = getLengthOfCodePoint(str);
        $('.codePointAt_length span').innerHTML = realLen;
        console.log(`å­—ç¬¦ä¸² ${str} é€šè¿‡å­—ç¬¦ç ç‚¹åˆ¤æ–­é•¿åº¦ä¸º: ${realLen}`);

        // åˆ©ç”¨codePointAtçš„èŒƒå›´ç»Ÿè®¡å­—èŠ‚æ•°
        const byteCount1 = getUTF8ByteByCodePoint(str);
        $('.codePontByte span').innerHTML = byteCount1;
        console.log(`å­—ç¬¦ä¸² ${str} åˆ©ç”¨codePointAtçš„èŒƒå›´ç»Ÿè®¡çš„å­—èŠ‚æ•°ä¸º: ${byteCount1}`);

        // TextEncoderå®ä¾‹æ–¹æ³•encodeè·å–å­—ç¬¦ä¸²å­—èŠ‚æ•°
        const byteCount2 = getStringByteByTextEncoder(str);
        $('.TextEncoder span').innerHTML = byteCount2;
        console.log(`å­—ç¬¦ä¸² ${str} TextEncoderå®ä¾‹æ–¹æ³•encodeç»Ÿè®¡çš„å­—èŠ‚æ•°ä¸º: ${byteCount2}`);

        // è½¬äºŒè¿›åˆ¶æµï¼Œè¯»å–size
        const byteCount3 = getStringByteSize(str);
        $('.blob span').innerHTML = byteCount3;
        console.log(`å­—ç¬¦ä¸² ${str} è½¬äºŒè¿›åˆ¶è¯»å–sizeçš„å­—èŠ‚æ•°ä¸º: ${byteCount3}`);
      })();
    </script>
  </body>
</html>
