<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Count Bytes</title>
  </head>
  <body>
    <h4>Count Bytes - å­—ç¬¦ä¸²æ‰€å å­—èŠ‚æ•°</h4>
    <hr />
    <p style="color: #00ff">é å­—ç¬¦ä¸²çš„lengthé•¿åº¦éå†å­—ç¬¦ä¸²ç»Ÿè®¡ï¼Œæ˜¯ä¸å‡†ç¡®çš„</p>
    <p class="charCodeAt_length">
      åˆ©ç”¨charCodeAtçš„èŒƒå›´ï¼Œç›´æ¥éå†å­—ç¬¦lengthï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <p class="charCodeAt">
      åˆ©ç”¨charCodeAtçš„èŒƒå›´ï¼Œé€šè¿‡ç å…ƒéå†ï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <p class="blob">
      åˆ©ç”¨Blobçš„sizeå±æ€§ï¼ŒğŸ…æ‰€å å­—èŠ‚æ•°ä¸º
      <span></span>
    </p>
    <script type="module">
      import { getLengthOfCodePoint } from '/utils/string.js';

      /**
       * charCodeAtç»Ÿè®¡å­—ç¬¦ä¸²æ‰€å å­—èŠ‚æ•°
       * @param str{string} å­—ç¬¦ä¸²
       * @param isCodePointLen{boolean} æ˜¯å¦é€šè¿‡ç ç‚¹è®¡ç®—çš„é•¿åº¦
       */
      function countBytes(str, isCodePointLen = true) {
        let count = 0;
        const len = isCodePointLen ? getLengthOfCodePoint(str) : str.length;
        for (let i = 0; i < len; i++) {
          const charCode = str.charCodeAt(i);
          if (charCode <= 0x007f) {
            count += 1; // ASCII å­—ç¬¦ï¼Œå ç”¨ä¸€ä¸ªå­—èŠ‚
          } else if (charCode <= 0x07ff) {
            count += 2; // Latin-1 è¡¥å……å­—ç¬¦ï¼Œå ç”¨ä¸¤ä¸ªå­—èŠ‚
          } else if (charCode <= 0xffff) {
            count += 3; // BMP ä¸­çš„å…¶ä»–å­—ç¬¦ï¼Œå ç”¨ä¸‰ä¸ªå­—èŠ‚
          } else {
            count += 4; // å…¶ä»– Unicode å­—ç¬¦ï¼Œå ç”¨å››ä¸ªå­—èŠ‚
          }
        }
        return count;
      }

      /**
       * Blobç»Ÿè®¡å­—ç¬¦ä¸²æ‰€å å­—èŠ‚æ•°
       * @param str{string} å­—ç¬¦ä¸²
       */
      function getStringByteSize(str) {
        return new Blob([str]).size;
      }

      (() => {
        const $ = document.querySelector.bind(document);

        // ç›´æ¥é€šè¿‡å­—ç¬¦lengthéå†
        const str = 'ğŸ…';
        const byteCount = countBytes(str, false);
        $('.charCodeAt_length span').innerHTML = byteCount;
        console.log("å­—ç¬¦ä¸² '" + str + "' çš„å­—èŠ‚æ•°ä¸º: " + byteCount);

        // é€šè¿‡ç ç‚¹è·å–é•¿åº¦å†éå†
        const str1 = 'ğŸ…';
        const byteCount1 = getStringByteSize(str1);
        $('.charCodeAt span').innerHTML = byteCount1;
        console.log("å­—ç¬¦ä¸² '" + str1 + "' çš„å­—èŠ‚æ•°ä¸º: " + byteCount1);

        // è½¬äºŒè¿›åˆ¶æµï¼Œè¯»å–size
        const str2 = 'ğŸ…';
        const byteCount2 = getStringByteSize(str1);
        $('.blob span').innerHTML = byteCount2;
        console.log("å­—ç¬¦ä¸² '" + str1 + "' çš„å­—èŠ‚æ•°ä¸º: " + byteCount2);
      })();
    </script>
  </body>
</html>
