<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/vue/favicon.ico" type="image/x-icon" />
    <title>vue3 proxy test</title>
    <style>
      p {
        color: #444;
      }
    </style>
  </head>
  <body>
    <h4>vue3 å“åº”å¼æ‰‹å†™å®ç°æµ‹è¯•</h4>
    <h5 style="color: #00ff">F12 æ§åˆ¶å°æŸ¥çœ‹æµ‹è¯•è¾“å‡º</h5>
    <hr />

    <p style="color: #999">ã€å…³äº computedã€‘</p>
    <p>âœ¨ computed çš„ getter éœ€è¦è¯»å–å“åº”å¼æ•°æ®</p>
    <p>
      âœ¨ computed çš„ getter åªæœ‰è¯»å–å±æ€§ value ä¸”å†…éƒ¨çš„ dirty çŠ¶æ€å€¼ä¸º
      trueï¼Œæ‰ä¼šæ‰§è¡Œï¼Œå®šä¹‰çš„æ—¶å€™å¹¶ä¸ä¼šæ‰§è¡Œ
    </p>
    <p>
      ğŸ å†…éƒ¨çš„ dirty çŠ¶æ€å€¼åˆå§‹ä¸º trueï¼Œè¯»å–valueæ—¶ï¼Œä¼šè§¦å‘getterï¼Œå¹¶æ”¶é›†ä¾èµ–å…³ç³»ï¼Œå†å°† dirty
      è®¾ä¸ºfalseï¼Œç¼“å­˜è®¡ç®—ç»“æœï¼Œåç»­è¯»å–çš„ value éƒ½æ˜¯ç¼“å­˜ç»“æœ
    </p>
    <p>
      ğŸ‘† åç»­åªæœ‰getterä¸­ä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘ scheduler å°† dirty ç½®ä¸º trueï¼Œä¸‹æ¬¡è¯»å–
      valueæ‰ä¼šå†æ¬¡è§¦å‘ä¸Šä¸€æ­¥
    </p>

    <script type="module">
      import { reactive } from './core/reactive.js';
      import { effect } from './core/effect.js';
      import { ref } from './ref.js';
      import { computed } from './computed.js';
      import { watch } from './watch.js';

      // const obj = {};
      // const arr = [1, 2, obj, 3, 4];
      // const state = reactive(arr);

      const obj = { a: 1, b: 2 };
      const state = reactive(obj);
      const objRef = ref({ f: 'f' });
      const sum = computed(() => {
        const res = state.a + state.b;
        console.log('computed', res);
        return res;
      });

      // effect(() => {
      //   console.log('changed');
      //   sum.value;
      // });

      // const sum1 = computed({
      //   get() {
      //     const res = state.a + state.b;
      //     console.log('computed', res);
      //     return res;
      //   },
      //   set(val) {
      //     console.log(val);
      //   }
      // });

      watch(
        () => state.a,
        (newVal, oldVal) => {
          console.log('ã€newã€‘', newVal, 'ã€oldã€‘', oldVal);
        }
        // {
        //   immediate: true
        // }
      );

      console.log(sum.value);
      state.a = 3;
      // sum.value = 4;
      console.log(sum.value);
      console.log(sum.value);
      // state.b = 3;
      // console.log(sum.value);

      // effect(() => {
      //   console.log('render', sum.value);
      // });

      // sum.value;
      // sum.value;
      // sum.value;

      // state.a = 2;
      // sum.value;
      // sum.value;

      // function test() {
      // const res = state.includes(obj);
      // const res = state.indexOf(obj);
      // const res = state.lastIndexOf(obj);
      // console.log(res);
      // state.push('test');
      // state.pop();
      // state.length = 3;
      // state.length = 100;
      // state.shift();

      //   console.log(`test a=${state.a}`);
      //   if (state.a === 1) {
      //     state.b;
      //   } else {
      //     state.c;
      //   }
      // }
      // function test1() {
      //   // console.log('test1', init.value);
      //   console.log('test1', objRef.value.f);
      //   // state.c;
      //   // for (const key in state) {
      //   // }
      //   // effect(() => {
      //   //   console.log('inner');
      //   // });
      // }
      // let isRun = false;
      // const fn = effect(test1, {
      //   lazy: true,
      //   scheduler(eff) {
      //     // æ”¾å…¥å¾®é˜Ÿåˆ— è¿™æ ·å‡½æ•°ä¸­çš„å€¼éƒ½æ˜¯æœ€æ–°å€¼
      //     Promise.resolve().then(() => {
      //       if (!isRun) {
      //         isRun = true;
      //         console.log(fn === eff);
      //         eff();
      //       }
      //     });
      //   }
      // });
      // effect(test1);
      // fn();
      // state.a++;
      // state.a++;
      // state.a++;
      // state.a++;
      // state.c = 3;
      // console.log(state.a);

      // const newObj = { f: 5 };
      // objRef.value = 2;
      // objRef.value = newObj;
    </script>
  </body>
</html>
